;ECE 425L - Group 1
;Name: Michael Granberry, Clayton Lawton
;Email: michael.granberry.612@my.csun.edu, clayton.lawton.209@my.csun.edu
;Last Modification Date: April 25, 2022
;Version: 1.0
				GLOBAL LEDSETUP
				GLOBAL LEDON
				GLOBAL LEDOFF
				GLOBAL LEDP0
				GLOBAL LEDP1
				GLOBAL LEDP2
				GLOBAL LEDP3
				GLOBAL	delay
				;IMPORT DELAY
rDELAY 			RN 12
;PINS
PINSEL0			EQU	0XE002C000
IO0BASE			EQU	0XE0028000
IO0PIN			EQU	0X0
IO0SET			EQU 0x4
IO0DIR			EQU	0x8
IO0CLR			EQU 0xC

;LED
LEDTOGGLE		EQU	0X00000000
LEDTOGGLEOFF	EQU	0XFF00
LED0PATTERN		EQU	0X00003300
LED1PATTERN		EQU	0XFFFFFF7F
LED2PATTERN		EQU	0X0000AA00
LED3PATTERN		EQU	0X00005500
	
;IO_DIR
OUTPUT			EQU 0X0000FF00

			AREA led_setup, CODE, READONLY
LEDSETUP
	STMFD SP!,{R0-R1, LR}
	MRS R0, CPSR
	STMFD SP!,{R0}
	
	;GPIO SETUP
	LDR R0, =PINSEL0
	MOV R1, #0X0
	STR	R1, [R0]
	
	LDR R0, =IO0BASE
	
	;IO0DIR
	LDR R1, =OUTPUT
	STR R1, [R0, #IO0DIR]
	
	BL LEDOFF
	
	LDMFD SP!, {R0}
	MSR CPSR_f, R0
	LDMFD SP!, {R0-R1,PC}

LEDON
	STMFD SP!,{R0-R1, LR}
	MRS R0, CPSR
	STMFD SP!,{R0}
	
	LDR R0, =IO0BASE
	
	;TOGGLE LED ON
	MOV R1, #LEDTOGGLE
	STR	R1, [R0, #IO0PIN]
	
	
	LDMFD SP!, {R0}
	MSR CPSR_f, R0
	LDMFD SP!, {R0-R1,PC}
	
LEDOFF
	STMFD SP!,{R0-R1, LR}
	MRS R0, CPSR
	STMFD SP!,{R0}
	
	LDR R0, =IO0BASE
	
	;TOGGLE LED OFF
	MOV R1, #LEDTOGGLEOFF
	STR	R1, [R0, #IO0SET]
	
	LDMFD SP!, {R0}
	MSR CPSR_f, R0
	LDMFD SP!, {R0-R1,PC}
	
LEDP0
	STMFD SP!,{R0-R1, LR}
	MRS R0, CPSR
	STMFD SP!,{R0}
	
	LDR R0, =IO0BASE
	
	;TOGGLE LED ON
	MOV R1, #LED0PATTERN
	STR	R1, [R0, #IO0PIN]
	
	LDMFD SP!, {R0}
	MSR CPSR_f, R0
	LDMFD SP!, {R0-R1,PC}
	
LEDP1
	STMFD SP!,{R0-R2, LR}
	MRS R0, CPSR
	STMFD SP!,{R0}
	
	LDR R0, =IO0BASE
	
	LDR R1, =LED1PATTERN
LOOP
	;LED ON
	MOV R1, R1, LSL #1
	STR R1, [R0, #IO0PIN]
	LDR rDELAY, =0x000ff00
	;DELAY
	BL delay
	
	;TEST LED CONDITIONALLY
	LDR R2, =0xFFFF7F00
	CMP R1, R2
	BNE LOOP
	
	LDMFD SP!, {R0}
	MSR CPSR_f, R0
	LDMFD SP!, {R0-R2,PC}

LEDP2
    STMFD SP!,{R0-R1, LR}
    MRS R0, CPSR
    STMFD SP!,{R0}
    
    LDR R0, =IO0BASE
    
    ;TOGGLE LED ON
    MOV R1, #LED2PATTERN
    STR R1, [R0, #IO0PIN]
    
    LDMFD SP!, {R0}
    MSR CPSR_f, R0
    LDMFD SP!, {R0-R1,PC}
    
LEDP3
    STMFD SP!,{R0-R1, LR}
    MRS R0, CPSR
    STMFD SP!,{R0}
    
    LDR R0, =IO0BASE
    
    ;TOGGLE LED ON
    MOV R1, #LED3PATTERN
    STR R1, [R0, #IO0PIN]
	
	LDMFD SP!, {R0}
	MSR CPSR_f, R0
	LDMFD SP!, {R0-R1,PC}
	
	
delay
	STMFD SP!,{R0-R2, LR}
	MRS R0, CPSR
	STMFD SP!,{R0}

D_LOOP
	SUBS R12, R12, #1
	BNE D_LOOP
			
	LDMFD SP!, {R0}
	MSR CPSR_f, R0
	LDMFD SP!, {R0-R2,PC}

STOP 		B	STOP
			END